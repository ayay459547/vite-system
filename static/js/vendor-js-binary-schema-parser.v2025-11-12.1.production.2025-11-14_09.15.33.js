const p=(t,e,r={},o=r)=>{if(Array.isArray(e))e.forEach(n=>p(t,n,r,o));else if(typeof e=="function")e(t,r,o,p);else{const n=Object.keys(e)[0];Array.isArray(e[n])?(o[n]={},p(t,e[n],r,o[n])):o[n]=e[n](t,r,o,p)}return r},u=(t,e)=>(r,o,n,s)=>{e(r,o,n)&&s(r,t,o,n)},k=(t,e)=>(r,o,n,s)=>{const i=[];let c=r.pos;for(;e(r,o,n);){const d={};if(s(r,t,o,d),r.pos===c)break;c=r.pos,i.push(d)}return i},I=t=>({data:t,pos:0}),a=()=>t=>t.data[t.pos++],S=(t=0)=>e=>e.data[e.pos+t],l=t=>e=>e.data.subarray(e.pos,e.pos+=t),f=t=>e=>e.data.subarray(e.pos,e.pos+t),h=t=>e=>Array.from(l(t)(e)).map(r=>String.fromCharCode(r)).join(""),x=t=>e=>{const r=l(2)(e);return(r[1]<<8)+r[0]},v=(t,e)=>(r,o,n)=>{const s=typeof e=="function"?e(r,o,n):e,i=l(t),c=new Array(s);for(var d=0;d<s;d++)c[d]=i(r);return c},A=(t,e,r)=>{for(var o=0,n=0;n<r;n++)o+=t[e+n]&&2**(r-n-1);return o},b=t=>e=>{const r=a()(e),o=new Array(8);for(var n=0;n<8;n++)o[7-n]=!!(r&1<<n);return Object.keys(t).reduce((s,i)=>{const c=t[i];return c.length?s[i]=A(o,c.index,c.length):s[i]=o[c.index],s},{})};var g={blocks:t=>{const r=[],o=t.data.length;for(var n=0,s=a()(t);s!==0&&s;s=a()(t)){if(t.pos+s>=o){const y=o-t.pos;r.push(l(y)(t)),n+=y;break}r.push(l(s)(t)),n+=s}const i=new Uint8Array(n);for(var c=0,d=0;d<r.length;d++)i.set(r[d],c),c+=r[d].length;return i}};const w=u({gce:[{codes:l(2)},{byteSize:a()},{extras:b({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:x()},{transparentColorIndex:a()},{terminator:a()}]},t=>{var e=f(2)(t);return e[0]===33&&e[1]===249}),z=u({image:[{code:a()},{descriptor:[{left:x()},{top:x()},{width:x()},{height:x()},{lct:b({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},u({lct:v(3,(t,e,r)=>Math.pow(2,r.descriptor.lct.size+1))},(t,e,r)=>r.descriptor.lct.exists),{data:[{minCodeSize:a()},g]}]},t=>S()(t)===44),B=u({text:[{codes:l(2)},{blockSize:a()},{preData:(t,e,r)=>l(r.text.blockSize)(t)},g]},t=>{var e=f(2)(t);return e[0]===33&&e[1]===1}),C=u({application:[{codes:l(2)},{blockSize:a()},{id:(t,e,r)=>h(r.blockSize)(t)},g]},t=>{var e=f(2)(t);return e[0]===33&&e[1]===255}),j=u({comment:[{codes:l(2)},g]},t=>{var e=f(2)(t);return e[0]===33&&e[1]===254}),E=[{header:[{signature:h(3)},{version:h(3)}]},{lsd:[{width:x()},{height:x()},{gct:b({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:a()},{pixelAspectRatio:a()}]},u({gct:v(3,(t,e)=>Math.pow(2,e.lsd.gct.size+1))},(t,e)=>e.lsd.gct.exists),{frames:k([w,C,j,z,B],t=>{var e=S()(t);return e===33||e===44})}];export{I as b,p,E as s};
