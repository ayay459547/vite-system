import{$ as J,g as Q,a1 as ce,m as ve,n as U,h as Y,a0 as ue,L as we,d as pe,e as me,f as I,s as _e}from"./index.v2025-11-12.1.production.2025-11-14_09.15.33.js";import{n as ke,x as j,u as ae,y as _}from"./vendor-@vue/reactivity.v2025-11-12.1.production.2025-11-14_09.15.33.js";import{v as le}from"./vendor-@vue/runtime-dom.v2025-11-12.1.production.2025-11-14_09.15.33.js";import xe from"./CustomDraggable.v2025-11-12.1.production.2025-11-14_09.15.33.js";import{_ as Ce}from"./CustomScrollbar.vue_vue_type_script_setup_true_lang.v2025-11-12.1.production.2025-11-14_09.15.33.js";import{d as fe,i as ye,aF as ge,b as se,c as S,o as p,g as G,aN as E,a as v,P as q,O as L,F as re,aq as Z,r as C,U as ie,aP as oe,f as Se,s as $e,R as Ee,ae as X,K as Ke,a1 as Fe,n as De}from"./vendor-@vue/runtime-core.v2025-11-12.1.production.2025-11-14_09.15.33.js";import{F as H,G as te,X as N,W as Re}from"./vendor-@vue/shared.v2025-11-12.1.production.2025-11-14_09.15.33.js";import{_ as be}from"./vendor-vue-qr.v2025-11-12.1.production.2025-11-14_09.15.33.js";import{_ as Le}from"./CustomPopover.vue_vue_type_script_setup_true_lang.v2025-11-12.1.production.2025-11-14_09.15.33.js";import"./vendor-exceljs.v2025-11-12.1.production.2025-11-14_09.15.33.js";const pt=(T,D,A=[])=>{const g={},n={},m=ke({});J(T,(e,l)=>{if(Y(e,D)){const d=ue(e,{type:D,key:l},m);g[l]=d,n[l]=(d==null?void 0:d.default)??null}});const h=j([]),k=A.map(e=>{const l=Q();return{id:l,key:l,...e,__key__:l}});h.value.push(...k);const R=()=>{setTimeout(()=>{J(m,(e,l)=>{if(typeof(e==null?void 0:e.getDom)!="function")return;const d=e.getDom();U(d)&&delete m[l]})},0)};return ce(g),{refMap:m,defaultValue:n,columns:g,forms:h,reset:()=>{h.value.splice(0),h.value.push(...k)},validate:async()=>{const e=[],l=[],d=[],c=[];return J(m,i=>{if(typeof(i==null?void 0:i.getDom)!="function")return;const x=i.getDom(),{key:K,value:V,getDom:w}=i;U(x)||(e.push(i.validate()),l.push({key:K,value:V,input:i,el:x,getDom:w}))}),await Promise.all(e).then(i=>{i.forEach((x,K)=>{const{errors:V,valid:w}=x,M={...l[K],errors:V,valid:w};w?d.push(M):c.push(M)})}).catch(i=>{throw ve({type:"error",message:i,duration:1e4}),new Error(i)}),new Promise((i,x)=>{c.length>0?x(c):i(d)})},add:e=>{const l=Q(),d={id:l,key:l,...n,...e,__key__:l};return h.value.push(d),d},remove:e=>{const l=h.value.splice(e,1);return R(),Array.isArray(l)?l[0]:null},clear:()=>{h.value.splice(0),R()}}},de=(T,D,A)=>{const g=[];J(T,(m,h)=>{if(Y(m,D)){const k=ue(m,{type:D,key:h},{});g.push(k)}});const n=async(m,h)=>{const k=we({...h}),R=k.addWorksheet(A,{properties:{tabColor:{argb:"FFFFFF"},defaultRowHeight:20,showGridLines:!0,outlineLevelCol:0,outlineLevelRow:0,dyDescent:55}}),e=[];g.forEach(l=>{let d=100;if(l.key&&Y(T,l.key)){const c=T[l.key][D]??null;if(c){const i=(c==null?void 0:c.width)??0,x=(c==null?void 0:c.minWidth)??0;d=Math.max(d,i,x);const K=(c==null?void 0:c.align)??"left";e.push({header:l.label,key:l.key,hidden:!1,style:{alignment:{horizontal:K,vertical:"middle"}},width:Math.round(d/10)})}}}),R.columns=e,m.forEach(l=>{R.addRow(l)}),k.xlsx.writeBuffer().then(l=>{const d=document.createElement("a"),c=new Blob([l],{type:"application/vnd.ms-excel;charset=utf-8;"});d.download=".xlsx",d.href=URL.createObjectURL(c),d.click()})};return ce(g),{title:"",tableColumns:g,downloadExcel:n}},qe="__SimpleTable_2.0.0__",Te={modelValue:{type:Array,default:()=>[]},isDraggable:{type:Boolean,default:!1},handle:{type:String,default:void 0},group:{type:String,default:"name"},itemKey:{type:String,default:"id",description:`
      功能類似 CustomTable: rowKey
      對應到 CustomDraggable: itemKey
    `},move:{type:Function,required:!1,default:null,description:`
      用於draggable的移動後回調函式
    `},disabled:{type:[Function,Boolean,void 0],required:!1,default:!1,description:"定義是否可移動"},rowClassName:{type:Function,default:void 0,description:"row class callback"},rowStyle:{type:Function,default:void 0,description:"row style callback"},cellClassName:{type:Function,default:void 0,description:"cell class callback"},cellStyle:{type:Function,default:void 0,description:"cell style callback"},i18nModule:{type:String,default:pe},hideHeader:{type:Boolean,default:!1},tableData:{type:Array,default:()=>[]},tableColumns:{type:Array,default:()=>[]}},Ve={class:"simple-table-container"},Be={key:0,class:"simple-table-header"},Ie={class:"simple-table-row-container"},Ne=["onClick"],Ae={class:"simple-table-row-expand"},Me={key:2,class:"simple-table-emtpy"},Pe=fe({__name:"SimpleTable",props:Te,emits:["update:model-value","expand-change","start","end","change"],setup(T,{expose:D,emit:A}){const g=Q(qe),n=T,m=A,h=ye("useHook"),{i18nTranslate:k}=h({i18nModule:n.i18nModule}),R=ge(),e=s=>!!R[s],l=se({get:()=>U(n.modelValue)?n.tableData:n.modelValue,set:s=>{m("update:model-value",s)}}),d=se(()=>{const s=[...n.tableColumns];return e("row-expand")&&s.unshift({width:40,align:"center",key:"row-expand",slotKey:"row-expand",isOperations:!0}),s}),c=(s,y)=>{if(s==="row-expand")return null;if(y){if(e(`header-${s}`))return`header-${s}`;if(e("header-all"))return"header-all"}else{if(e(`column-${s}`))return`column-${s}`;if(e("column-all"))return"column-all"}return null},i=s=>{const{rowData:y,rowIndex:t}=s;let r={};return typeof n.rowStyle=="function"&&(r=n.rowStyle({row:y,rowIndex:t},[])),r},x=s=>{const{rowData:y,rowIndex:t}=s;let r="";return typeof n.rowClassName=="function"&&(r=n.rowClassName({row:y,rowIndex:t},[])),[t%2===0?"is-even":"",r]},K=s=>{const{rowData:y,rowIndex:t,column:r,columnIndex:u}=s,{width:b=0,minWidth:a=0}=r??{};let f={};t>=0&&typeof n.cellStyle=="function"&&(f=n.cellStyle({row:y,rowIndex:t,column:r,columnIndex:u},[]));const o={...f};return b>0&&(o.width=`${b}px`,o["max-width"]=`${b}px`,o["min-width"]=`${b}px`),a>0&&(o.width=`${a}px`,o["min-width"]=`${b}px`),o},V=s=>{const{rowData:y,rowIndex:t,column:r,columnIndex:u}=s;let b=[];return t>=0&&typeof n.cellClassName=="function"&&(b=n.cellClassName({row:y,rowIndex:t,column:r,columnIndex:u},[])),[...Array.isArray(b)?b:[b],`column-${(r==null?void 0:r.align)??"left"}`]},w=ae(new Set),M=(s,y)=>{const{rowKey:t,row:r,rowIndex:u}=s;y??!w.has(t)?w.add(t):w.delete(t),W(r,w.has(t),u,t)},W=(s,y,t,r)=>{m("expand-change",s,y,t,r)},O=s=>m("start",s),B=s=>m("end",s),z=s=>m("change",s);return D({toggleRowExpansion:(s,y)=>{const t=s[n.itemKey]??"",r=l.value.findIndex(u=>t===u[n.itemKey]);M({rowKey:t,row:s,rowIndex:r},y)}}),(s,y)=>(p(),S("div",{class:H(["simple-table",_(g)])},[G(Ce,null,{default:E(()=>[v("div",Ve,[n.hideHeader?q("",!0):(p(),S("div",Be,[(p(!0),S(re,null,Z(d.value,(t,r)=>(p(),S("div",{key:`header-${t.key}`,style:te(K({rowData:{},rowIndex:-1,column:t,columnIndex:r})),class:H([V({rowData:{},rowIndex:-1,column:t,columnIndex:r}),"simple-table-column"])},[C(s.$slots,c((t==null?void 0:t.slotKey)??t.key,!0),{key:t.key,prop:t.key,row:[],rowIndex:-1,column:t,columnIndex:r,data:_(k)((t==null?void 0:t.i18nLabel)??t.label)},()=>[ie(N(_(k)((t==null?void 0:t.i18nLabel)??t.label)),1)],!0)],6))),128))])),Array.isArray(l.value)&&l.value.length>0?(p(),L(xe,{key:1,modelValue:l.value,"onUpdate:modelValue":y[0]||(y[0]=t=>l.value=t),handle:n.handle,group:n.group,itemKey:n.itemKey,move:n.move,disabled:n.isDraggable?n.disabled:!0,class:"simple-table-body",onStart:O,onEnd:B,onChange:z},{item:E(({element:t,index:r})=>[v("div",Ie,[v("div",{class:H(["simple-table-row",x({rowData:t,rowIndex:r})]),style:te(i({rowData:t,rowIndex:r}))},[(p(!0),S(re,null,Z(d.value,(u,b)=>(p(),S("div",{key:`column-${u.key}`,style:te(K({rowData:t,rowIndex:r,column:u,columnIndex:b})),class:H([V({rowData:t,rowIndex:r,column:u,columnIndex:b}),"simple-table-column"])},[C(s.$slots,c((u==null?void 0:u.slotKey)??u.key,!1),{key:u.key,prop:u.key,row:t,rowIndex:r,column:u,columnIndex:b,data:t[u.key]},()=>[ie(N(t[u.key]),1)],!0),u.key==="row-expand"?(p(),S("div",{key:0,class:"row-expand",onClick:a=>M({rowKey:t[n.itemKey],row:t,rowIndex:r})},[G(me,{name:"angle-right",class:H(["arrow",w.has(t[n.itemKey])?"is-open":""])},null,8,["class"])],8,Ne)):q("",!0)],6))),128))],6),oe(v("div",Ae,[C(s.$slots,"row-expand",{rowKey:t[n.itemKey],row:t,rowIndex:r,expanded:w.has(t[n.itemKey])},void 0,!0)],512),[[le,w.has(t[n.itemKey])]])])]),_:3},8,["modelValue","handle","group","itemKey","move","disabled"])):(p(),S("div",Me,N(_(k)("empty-data")),1))])]),_:3})],2))}}),He=be(Pe,[["__scopeId","data-v-446a24ae"]]),Ue="__FormList_1.0.0__",We={modelValue:{type:Array,default:()=>[]},label:{type:String,required:!1,default:""},min:{type:Number,required:!1,default:0},max:{type:Number,required:!1,default:1/0},columnSetting:{type:Object,required:!0,default:()=>({})},tableKey:{type:String,required:!1,default:"table"},itemKey:{type:String,required:!1,default:"id",description:`
      CustomTable: rowKey
      CustomDraggable: itemKey
    `},isDraggable:{type:Boolean,required:!1,default:!1},draggableGroup:{type:String,required:!1},isEdit:{type:Boolean,required:!1,default:!0,description:"是否可編輯"},isCreate:{type:Boolean,required:!1,default:!1,description:"是否可新增"},createPosition:{type:String,required:!1,default:"center",description:`
      新增用按鈕的顯示位置
      種類: 'center' | 'right' | 'left'
    `},isRemove:{type:Boolean,required:!1,default:!1,description:"是否可刪除"},isShowNo:{type:Boolean,required:!1,default:!0,description:"是否顯示編號"},isCollapse:{type:Boolean,required:!1,default:!1,description:`
      是否允許摺疊FormList, 僅顯示標題與摺疊鍵
    `},move:{type:Function,required:!1,default:null,description:"用於draggable的移動後回掉函式"},disabled:{type:Function,required:!1,default:void 0,description:"用於定義draggable是否可移動"},setDisabled:{type:Function,required:!1,default:()=>!1,description:`
      用於判斷FormList Item是否禁止操作
    `},i18nModule:{type:String,default:pe}},Oe={key:0,class:"__form-list__ form-top"},ze={class:"__form-list__ form-title"},je={key:0,class:"__form-list__"},Ge={class:"__form-list__ form-content"},Xe={class:"__form-list__ form-table"},Je={class:"text-danger i-pr-xs"},Qe={class:"i-selection-operations-header cursor-pointer"},Ye={class:"flex-column i-ga-xs"},Ze={key:0,class:"flex-row"},et={key:1,class:"flex-row"},tt=fe({__name:"FormList",props:We,emits:["mounted","add","remove","clear","update:model-value","expand-change","start","end","change"],setup(T,{expose:D,emit:A}){const g=Q(Ue),n=ge(),m=a=>Y(n,a),h=(a,f)=>{switch(f){case"header":if(m(`header-${a}`))return`header-${a}`;break;case"column":if(m(`column-${a}`))return`column-${a}`;if(m("column-all"))return"column-all";break}return"empty"},k=a=>h(a,"header"),R=a=>h(a,"column"),e=T,l=A,d=ye("useHook"),{i18nTranslate:c}=d({i18nModule:e.i18nModule}),i=se({get:()=>e.modelValue,set:a=>{l("update:model-value",a)}}),x=j(),K=j(),V=()=>{i.value.length>=e.max||(l("add"),De(()=>{const a=document.querySelectorAll(`div[class*="${g}"] .custom-draggable-item:last-child`);if(U(a))return;const f=a[a.length-1];U(f)||_e(f,{block:"center"})}))},w=a=>{i.value.length<e.min+1||l("remove",a)},M=()=>{i.value=[],l("clear"),V()},W=ae({}),O=ae({}),B=j(!1),z=a=>{switch(a){case"open":B.value=!1;break;case"close":B.value=!0;break;default:B.value=!B.value;break}},ne=a=>{z(a)},s=j();D({setCollapse:ne,toggleRowExpansion:(a,f)=>{var o;return(o=s.value)==null?void 0:o.toggleRowExpansion(a,f)}}),Se(()=>{e.isShowNo&&(W.row_index={label:"#"},W.row_index[e.tableKey]={width:40,align:"center"}),(e.isRemove||e.isDraggable)&&(O.row_operations={label:"操作",i18nLabel:"operationCommands"},O.row_operations[e.tableKey]={width:90,align:"center",isOperations:!0});const{tableColumns:a}=de(e.columnSetting,e.tableKey);x.value=a;const{tableColumns:f}=de({...W,...e.columnSetting,...O},e.tableKey);K.value=f}),$e(()=>{l("mounted")});const t=(a,f,o,F)=>{l("expand-change",a,f,o,F)},r=a=>l("start",a),u=a=>l("end",a),b=a=>l("change",a);return(a,f)=>(p(),S("div",{class:H(["__form-list__ form-container hover-card-info",[_(g),B.value?"is-collapse":"is-expand"]])},[m("title")||!_(U)(e.label)?(p(),S("div",Oe,[v("div",ze,[C(a.$slots,"title",{label:e.label},()=>[v("label",null,N(e.label),1)],!0)]),e.isCollapse?(p(),S("div",je,[B.value?(p(),L(I,{key:0,"icon-name":"caret-down",text:"",plain:"",onClick:f[0]||(f[0]=o=>z())})):(p(),L(I,{key:1,"icon-name":"minus",size:"small",text:"",plain:"",onClick:f[1]||(f[1]=o=>z())}))])):q("",!0)])):q("",!0),oe(v("div",Ge,[v("div",Xe,[G(He,{ref_key:"SimpleTableRef",ref:s,modelValue:i.value,"onUpdate:modelValue":f[2]||(f[2]=o=>i.value=o),"item-key":e.itemKey,"is-draggable":a.isDraggable,handle:".__form-item-move__",move:e.move,disabled:e.disabled,group:e.draggableGroup??`${_(g)}`,"table-data":i.value,"table-columns":K.value,onExpandChange:t,onStart:r,onEnd:u,onChange:b},Ee({"header-all":E(({key:o,rowIndex:F,data:P,column:$})=>[C(a.$slots,"header-all",{label:P,rowIndex:F,column:$,prop:o},()=>[oe(v("div",Je,"*",512),[[le,$.required]]),v("div",null,N(_(c)(($==null?void 0:$.i18nLabel)??$.label)),1)],!0)]),"header-row_index":E(({data:o})=>[v("label",null,N(o),1)]),"column-row_index":E(({rowIndex:o})=>[v("span",null,N(o+1),1)]),"header-row_operations":E(o=>[C(a.$slots,"column-operations",Re(Fe(o)),()=>[G(Le,{trigger:"click","show-after":300,offset:8,"popper-class":"form-list-popover"},{reference:E(()=>[v("div",Qe,[G(me,{name:"gear"})])]),default:E(()=>[v("div",Ye,[v("label",null,N(_(c)("operationCommands")),1),e.isRemove&&e.isEdit?(p(),L(I,{key:0,type:"danger","icon-name":"trash-can",plain:"",label:_(c)("clear"),disabled:i.value.length<e.min+1,onClick:M},null,8,["label","disabled"])):q("",!0)])]),_:1})],!0)]),"column-row_operations":E(o=>[(p(),L(Ke,null,[e.setDisabled(o.row)?(p(),S("div",Ze,[C(a.$slots,"column-draggable",X({scopedId:_(g)},o),()=>[e.isDraggable?(p(),L(I,{key:0,type:"info","icon-x-type":"tabler","icon-name":"ArrowsUpDown",text:"",disabled:"",class:"__form-item-disable__"})):q("",!0)],!0),C(a.$slots,"column-remove",X({scopedId:_(g)},o),()=>[e.isRemove&&e.isEdit?(p(),L(I,{key:0,type:"danger","icon-name":"trash-can",text:"",disabled:i.value.length<e.min+1,onClick:F=>w(o.rowIndex)},null,8,["disabled","onClick"])):q("",!0)],!0)])):(p(),S("div",et,[C(a.$slots,"column-draggable",X({scopedId:_(g)},o),()=>[e.isDraggable?(p(),L(I,{key:0,type:"info","icon-x-type":"tabler","icon-name":"ArrowsUpDown",text:"",disabled:!e.isEdit,class:"__form-item-move__"},null,8,["disabled"])):q("",!0)],!0),C(a.$slots,"column-remove",X({scopedId:_(g)},o),()=>[e.isRemove&&e.isEdit?(p(),L(I,{key:0,type:"danger","icon-name":"trash-can",text:"",disabled:i.value.length<e.min+1,onClick:F=>w(o.rowIndex)},null,8,["disabled","onClick"])):q("",!0)],!0)]))],1024))]),_:2},[m("row-expand")?{name:"row-expand",fn:E(({rowKey:o,row:F,rowIndex:P,expanded:$})=>[C(a.$slots,"row-expand",{rowKey:o,row:F,rowIndex:P,expanded:$},void 0,!0)]),key:"0"}:void 0,Z(x.value,o=>({name:k(o.slotKey),fn:E(({key:F,rowIndex:P,data:$,column:ee})=>[C(a.$slots,k(o.slotKey),{label:$,rowIndex:P,column:ee,prop:F},void 0,!0)])})),Z(x.value,o=>({name:R(o.slotKey),fn:E(({key:F,row:P,rowIndex:$,data:ee,column:he})=>[C(a.$slots,R(o.slotKey),{data:ee,row:P,rowIndex:$,column:he,prop:F},void 0,!0)])}))]),1032,["modelValue","item-key","is-draggable","move","disabled","group","table-data","table-columns"])]),v("div",{class:H(`__form-list__ form-create ${e.createPosition}`)},[e.isCreate&&e.isEdit?(p(),L(I,{key:0,type:"primary",label:_(c)("add"),"icon-name":"plus","icon-move":"rotate",disabled:i.value.length>=e.max,onClick:V},null,8,["label","disabled"])):q("",!0)],2)],512),[[le,!B.value]])],2))}}),mt=be(tt,[["__scopeId","data-v-a16f25d5"]]);export{mt as F,pt as u};
